<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Night Sky Perceptions</title>
  <style>
    body { margin: 0; background: #0a0a1e; overflow: hidden; font-family: Arial, sans-serif; }
    #controls {
      position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
      display: flex; flex-direction: column; align-items: center; gap: 10px;
      background: rgba(20,20,40,0.8); padding: 10px 20px; border-radius: 10px;
    }
    button {
      padding: 8px 16px; font-size: 16px; border: none; border-radius: 6px;
      background: #444; color: #fff; cursor: pointer;
    }
    button:hover { background: #666; }
    input[type="range"] { width: 200px; }
    canvas { display: block; }
  </style>
</head>
<body>
<canvas id="sky"></canvas>

<div id="controls">
  <div>
    <button id="viewBtn">View: PLAN</button>
    <button id="dirBtn">Dir: EAST</button>
  </div>
  <label>
    Speed: <input type="range" id="speedSlider" min="0.5" max="3" step="0.1" value="1">
  </label>
</div>

<script>
const canvas = document.getElementById("sky");
const ctx = canvas.getContext("2d");
let W = window.innerWidth, H = window.innerHeight;
canvas.width = W; canvas.height = H;

let viewMode = "PLAN"; // PLAN or GROUND
let direction = "EAST"; // EAST or WEST
let speedMultiplier = 1.0;

document.getElementById("viewBtn").onclick = () => {
  viewMode = (viewMode === "PLAN") ? "GROUND" : "PLAN";
  document.getElementById("viewBtn").innerText = "View: " + viewMode;
};
document.getElementById("dirBtn").onclick = () => {
  direction = (direction === "EAST") ? "WEST" : "EAST";
  document.getElementById("dirBtn").innerText = "Dir: " + direction;
};
document.getElementById("speedSlider").oninput = e => {
  speedMultiplier = parseFloat(e.target.value);
};

// Object definitions
const OBJECT_TYPES = [
  {type: "Plane", color: [255,0,0], prob: 30},
  {type: "Helicopter", color: [0,0,255], prob: 20},
  {type: "Satellite", color: [255,255,255], prob: 20},
  {type: "Meteor", color: [255,255,150], prob: 20},
  {type: "Rare", color: [150,0,150], prob: 10},
];

function chooseWeighted(options) {
  let total = options.reduce((sum,o)=>sum+o.prob,0);
  let r = Math.random()*total, acc=0;
  for (let o of options) { acc+=o.prob; if(r<=acc) return o; }
  return options[0];
}

let objects = [];
function spawnObjects() {
  let id = 1;
  let counts = {};
  while(objects.length < 7) {
    let choice = chooseWeighted(OBJECT_TYPES);
    counts[choice.type] = (counts[choice.type]||0) + 1;
    if (counts[choice.type] <= 4) {
      objects.push(makeObject(id++, choice));
    }
  }
}
function makeObject(id, def) {
  let angle = Math.random()*Math.PI*2;
  let speed = 1+Math.random()*2;
  return {
    id, type: def.type, baseColor: def.color,
    x: Math.random()*W, y: Math.random()*H/2, z: Math.random()*100,
    vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed,
    trail: []
  };
}

function updateObject(o) {
  o.x += o.vx*speedMultiplier;
  o.y += o.vy*speedMultiplier;
  o.z += (Math.random()-0.5)*0.5;
  if(o.z<0) o.z=0; if(o.z>100) o.z=100;
  o.trail.push([o.x,o.y]);
  if(o.trail.length>10) o.trail.shift();
  if(o.x<0) o.x=W; if(o.x>W) o.x=0;
  if(o.y<0) o.y=H; if(o.y>H) o.y=0;
}

function drawObject(o) {
  let factor = 1 - (o.z/100);
  let color = o.baseColor.map(c=>Math.min(255, c + factor*80));
  ctx.fillStyle = `rgb(${color[0]},${color[1]},${color[2]})`;
  ctx.strokeStyle = ctx.fillStyle;
  if(viewMode==="PLAN") {
    ctx.beginPath();
    ctx.arc(o.x,o.y,W*0.008,0,Math.PI*2);
    ctx.fill();
    if(o.trail.length>1) {
      ctx.beginPath();
      ctx.moveTo(o.trail[0][0], o.trail[0][1]);
      for(let [tx,ty] of o.trail) ctx.lineTo(tx,ty);
      ctx.stroke();
    }
    ctx.fillStyle="#fff";
    ctx.fillText(o.id, o.x+10, o.y-10);
  } else {
    let gx = (direction==="EAST") ? o.x : W - o.x;
    let gy = H - (o.z*H*0.01);
    ctx.beginPath();
    ctx.arc(gx,gy,W*0.008,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle="#fff";
    ctx.fillText(o.id, gx+10, gy-10);
  }
}

function drawStars() {
  ctx.fillStyle="white";
  for(let i=0;i<50;i++) {
    ctx.fillRect(Math.random()*W, Math.random()*H,1,1);
  }
}

function loop() {
  ctx.fillStyle = "#0a0a1e";
  ctx.fillRect(0,0,W,H);
  drawStars();
  for(let o of objects) {
    updateObject(o);
    drawObject(o);
  }
  requestAnimationFrame(loop);
}

spawnObjects();
loop();
</script>
</body>
</html>
